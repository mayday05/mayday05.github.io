---
layout:     post
title:      精进消息中间件原理系列(一)：之消息堆积
subtitle:   消息堆积
date:       2020-01-11
author:     Mayday
header-img: img/post-bg-universe.jpg
catalog: true
tags:

- 消息中间件
---



#                                                                                          消息堆积



## 一、消息堆积主要原因

消息堆积主要原因：

1、生产者的生产消息速度>>消费者的处理消息速度，速度不匹配从引起的堆积；（消费者活着但是处理慢）

2、消费者实例IO阻塞严重或者挂机；（消费者宕机等）

3、消费者故障期间消息的堆积。（堆积累加）

单从增加消费者数是远远不够。之所以要处理消息堆积，是为了防止消息堆积所引起MQ的异常，所以在所有MQ的业务场景，消息如果是重要的，不容丢弃时，需要有备选方案，可以采用数据转移，增加中间缓冲技术。



## 二、不同消息中间件面对消息堆积的能力理解

> 除了异步解耦功能，消息队列 RocketMQ 版还有挡住前端数据洪峰的重要功能，以此保证后端系统的稳定性。这要求消息队列 RocketMQ 版具有一定的消息堆积能力。消息队列 RocketMQ 版能支持 10 亿级别的消息堆积，不会因为消息堆积导致性能明显下降。
>
> ---阿里云官网 [如何处理消息堆积？](https:///knowledge_detail/117349.html)

![image-20200111172226487](C:\Users\m12815\AppData\Roaming\Typora\typora-user-images\image-20200111172226487.png)



## 三、如何处理消息堆积

### 3.1 如何通过优化代码避免消息堆积

在消息的收发两端，我们的业务代码怎么和消息队列配合，达到一个最佳的性能。

#### 1、发送端性能优化



#### 2、 消费端性能优化



### 3.2 消息已经堆积了如何处理



对于系统发生消息积压的情况，需要先解决积压，再分析原因，毕竟保证系统的可用性是首先要解决的问题。快速解决积压的方法就是通过水平扩容增加 Consumer 的实例数量。

## 附 参考文章

1、阿里云官网 [如何处理消息堆积？](https://helpcdn.aliyun.com/knowledge_detail/117349.html)